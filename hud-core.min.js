// HUD-CORE v1.1.3

// This file enabled web-HUD features for Launchpad, the reative
// templating engine for Spaceport. Include this file in your
// HTML parts or vessels to enable the HUD features.

// For more information on HUD-CORE's features, see the documentation:
// https://spaceport.com.co/docs/launchpad#hud-core

function sendData(e,t){const r={"handler-id":e,...t};!function e(){socket&&socket.readyState===WebSocket.OPEN?(socket.send(JSON.stringify(r)),console.log("Sent data: "+t)):(setTimeout(e,25),console.log("Retrying to send data: "+t))}()}document.addEventListener("DOMContentLoaded",(function(){scanForComments(document);const e=new MutationObserver((function(e){e.forEach((function(e){if("childList"===e.type&&(e.addedNodes.forEach((function(e){if(e.nodeType===Node.COMMENT_NODE&&parseForDocumentData(e),e.nodeType===Node.ELEMENT_NODE){if(e.hasOwnProperty("mutated"))try{e.mutated(e)}catch(e){console.error(e)}for(let t=0;t<builtInEvents.length;t++){let r=builtInEvents[t];if(e.hasAttribute(r)){setupOnAttribute(r.substring(3),e)}}"SCRIPT"===e.tagName&&(console.log(`Evaluating script: ${e.innerHTML}`),window.eval(e.innerHTML)),e.hasAttribute("href")&&setupHREF(e),e.querySelectorAll&&e.querySelectorAll("*").forEach((function(t){if(t.hasOwnProperty("mutated"))try{t.mutated(e)}catch(e){console.error(e)}"SCRIPT"===t.tagName&&(console.log(`Evaluating script: ${t.innerHTML}`),window.eval(t.innerHTML));for(let e=0;e<builtInEvents.length;e++){let r=builtInEvents[e];if(t.hasAttribute(r)){setupOnAttribute(r.substring(3),t)}}if(t.hasAttribute("href")&&setupHREF(t),t.hasAttribute("popovertarget")){const e=t.getAttribute("popovertarget"),r=document.querySelector("#"+e);r&&r.togglePopover()}})),function e(t){let r=[];for(let n=0;n<t.childNodes.length;n++){let a=t.childNodes[n];a.nodeType===Node.COMMENT_NODE&&r.push(a),r=r.concat(e(a))}return r}(e).forEach((function(e){parseForDocumentData(e)}))}})),e.removedNodes.forEach((function(e){if(e.nodeType===Node.ELEMENT_NODE){if(e.hasOwnProperty("removed"))try{e.removed(e)}catch(e){console.error(e)}let t=[];if(e.hasAttribute("lp-uuid")&&t.push(e.getAttribute("lp-uuid")),e.querySelectorAll&&e.querySelectorAll("*").forEach((function(e){e.hasAttribute("lp-uuid")&&t.push(e.getAttribute("lp-uuid"))})),t.length>0){const e="/!/lp/bind/u/",r={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uuids:t})};fetch(e,r)}e.eventListeners&&e.eventListeners.forEach((t=>{e.removeEventListener(t.type,t.callback)}))}}))),"attributes"===e.type){const t=e.target;if(t.hasOwnProperty("attributeChanged"))try{t.attributeChanged(t,e.attributeName,e.oldValue,t.getAttribute(e.attributeName))}catch(e){console.error(e)}if(t.hasOwnProperty("attributechanged"))try{t.attributechanged(t,e.attributeName,e.oldValue,t.getAttribute(e.attributeName))}catch(e){console.error(e)}}}))}));builtInEvents.forEach((e=>{const t=e.substring(3);document.querySelectorAll("["+e+"]").forEach((r=>{if(console.log(`ATTACHED -> HUD-*:${t.toUpperCase()}: ${r.tagName}`),setupOnAttribute(t,r),"on-load"===e){let e=new Event("load");r.dispatchEvent(e)}}))})),document.querySelectorAll("[href]").forEach((e=>{setupHREF(e)}));e.observe(document.body,{attributes:!0,childList:!0,subtree:!0,attributeOldValue:!0})}));const builtInEvents=["on-click","on-dblclick","on-mouseover","on-mouseout","on-mouseenter","on-mouseleave","on-mousedown","on-mouseup","on-mousemove","on-keydown","on-keyup","on-keypress","on-change","on-input","on-submit","on-focus","on-focusout","on-focusin","on-blur","on-drag","on-dragend","on-dragenter","on-dragleave","on-dragover","on-dragstart","on-drop","on-wheel","on-touchstart","on-touchmove","on-touchend","on-touchcancel","on-load","on-select","on-contextmenu","on-beforeunload","on-formblur","on-nudge"];function getTargetElement(e){let t=e.currentTarget.getAttribute("target"),r=e.currentTarget;if(setTimeout((()=>{}),1),null===t&&null!=r){let e=r.parentElement;for(;null!=e;){if(e.hasAttribute("target")){t=e.getAttribute("target");break}e=e.parentElement}null!=e&&(r=e)}if("self"===t||"outer"===t)return r;if("none"===t)return null;if(null==t)return null;const n=r.hasAttribute("wrapper")?r.getAttribute("wrapper"):"div";switch(t){case"parent":return r.parentElement;case"grandparent":return r.parentElement.parentElement;case"next":return r.nextElementSibling;case"previous":return r.previousElementSibling;case"nextnext":return r.nextElementSibling.nextElementSibling;case"previousprevious":return r.previousElementSibling.previousElementSibling;case"first":return r.firstElementChild;case"last":return r.lastElementChild;case"after":return r.insertAdjacentHTML("afterend",`<${n}></${n}>`),r.nextElementSibling;case"before":return r.insertAdjacentHTML("beforebegin",`<${n}></${n}>`),r.previousElementSibling;case"append":return r.insertAdjacentHTML("beforeend",`<${n}></${n}>`),r.lastElementChild;case"prepend":return r.insertAdjacentHTML("afterbegin",`<${n}></${n}>`),r.firstElementChild;case"nth-sibling":const e=parseInt(r.getAttribute("index"),10);return r.parentNode?.children[e]||null;case"nth-child":const a=parseInt(r.getAttribute("index"),10);return r.children[a]||null;case"nth-parent":const o=parseInt(r.getAttribute("index"),10);return r.parentElement?.parentElement?.children[o]||null;default:return t.startsWith(">")?r.querySelector(t.substring(1)):t.startsWith("<")?r.closest(t.substring(1)):document.querySelector(t)||null}}function setupOnAttribute(e,t){const r=t.getAttribute("on-"+e);t.addEventListener(e,(n=>{fetchDataAndUpdate(n,r),"submit"===e&&"FORM"===t.tagName&&n.preventDefault(),"change"===e&&"INPUT"===t.tagName&&t.addEventListener("keydown",(e=>{"Enter"===e.key&&e.currentTarget.blur()}))})),t.setAttribute("lp-uuid",r.replace("/!/lp/bind?uuid=",""))}async function fetchDataAndUpdate(e,t){if(console.log("Triggered Event",e),e.target.hasAttribute("fatal-error"))return console.log("Component has fatal error, not fetching data."),void console.log(`EVENT -> ${e.type}\nELEMENT -> ${e.target.tagName}\nURL -> ${t}`);e.stopPropagation();const r=getTargetElement(e);let n=e.currentTarget;if(n&&"auto"!==e.currentTarget?.getAttribute("source")||(n=e.target),"strict"===e.currentTarget?.getAttribute("source")&&e.target!==e.currentTarget)return void console.log("Not firing. Strict.");if(e.currentTarget?.getAttribute("source")&&"auto"!==e.target.getAttribute("source")&&"auto"!==e.currentTarget.getAttribute("source")){let t=e.target;for(;t;){if(t.matches(e.currentTarget.getAttribute("source"))){n=t;break}if(t=t.parentElement,t===e.currentTarget){if(e.currentTarget.matches(e.currentTarget.getAttribute("source"))){n=e.currentTarget;break}t=null}}if(null===t&&console.log("No source match. Checking IDs."),null===t&&e.currentTarget.getAttribute("source").startsWith("#")&&(n=document.querySelector(e.currentTarget.getAttribute("source"))),null===t&&null==n)return void console.log("No source match.");console.log("SOURCE MATCH ("+e.currentTarget.getAttribute("source")+") -> "+n.tagName)}console.log(`EVENT -> ${e.type}\nTARGET ELEMENT -> ${e.target?.tagName}\nCURRENT-TARGET ELEMENT -> ${e.currentTarget?.tagName}\nACTIVE-TARGET ELEMENT -> ${n?.tagName}\nPAYLOAD-TARGET ELEMENT -> `+r?.tagName+`\nURL -> ${t}`);let a={},o=n.getAttribute("type"),s=n.tagName.toLowerCase();if("checkbox"===o||"radio"===o)n.checked&&(a.value=n.value);else if("select"===s&&n.multiple)a.value=Array.from(n.options).filter((e=>e.selected)).map((e=>e.value));else if("file"===o)if(1===n.files.length)a.value={name:n.files[0].name,data:await fileToBase64(n.files[0])};else{a.value=[];for(let e of n.files)a.value.push({name:e.name,data:await fileToBase64(e)})}else null!=n.value?a.value=n.value:null!=n.innerHTML&&"FORM"!==n.tagName&&(a.value=n.innerHTML.split("\n").map((e=>e.trim())).join(" ").replace(/\s+/g," "));if(null!=e.clientX&&(a.clientX=e.clientX),null!=e.clientY&&(a.clientY=e.clientY),null!=e.screenX&&(a.screenX=e.screenX),null!=e.screenY&&(a.screenY=e.screenY),null!=e.pageX&&(a.pageX=e.pageX),null!=e.pageY&&(a.pageY=e.pageY),null!=e.movementX&&(a.movementX=e.movementX),null!=e.movementY&&(a.movementY=e.movementY),null!=e.buttons&&(a.buttons=e.buttons),null!=e.button&&(a.button=e.button),null!=e.offsetX&&(a.offsetX=e.offsetX),null!=e.offsetY&&(a.offsetY=e.offsetY),null!=e.key&&(a.key=e.key),null!=e.keyCode&&(a.keyCode=e.keyCode),null!=e.shiftKey&&e.shiftKey&&(a.shiftKey=e.shiftKey),null!=e.ctrlKey&&e.ctrlKey&&(a.ctrlKey=e.ctrlKey),null!=e.altKey&&e.altKey&&(a.altKey=e.altKey),null!=e.metaKey&&e.metaKey&&(a.metaKey=e.metaKey),null!=e.repeat&&e.repeat&&(a.repeat=e.repeat),n.contentEditable&&n.isContentEditable&&(a.contentEditable="true"),n.hasAttribute("bind")&&(a.bind=n.getAttribute("bind")),n.id&&(a.elementId=n.id),a.classList=Array.from(n.classList),a.tagName=n.tagName,a.innerText=n.innerText?.trim(),a.textContent=n.textContent?.trim(),window.location.search){window.location.search.substring(1).split("&").forEach((e=>{const[t,r]=e.split("=").map(decodeURIComponent);a[t]=r}))}let i=n;for(;i&&"FORM"!==i.tagName;)i=i.parentElement;if(i&&"FORM"===i.tagName){const t=new FormData(i);for(let[r,n]of t.entries()){const t=i.elements[r];if(console.log(t),!t)continue;const o=t.type;if(["date","datetime-local","month","week","time"].includes(o)){const e=new Date(n);a[r]=e.getTime()}else if("checkbox"===o||"radio"===o)a[r]=t.checked;else if("file"===o)if("submit"===e.type){a[r]=[],t.setAttribute("loading","true");for(let e of t.files)a[r].push({name:e.name,value:await fileToBase64(e)});t.removeAttribute("loading")}else{a[r]=[];for(let e of t.files)a[r].push({name:e.name,value:null})}else a[r]="select-multiple"===o?Array.from(t.options).filter((e=>e.selected)).map((e=>e.value)):n}for(let e of i.querySelectorAll("[name]"))a[e.getAttribute("name")]||e.value&&(a[e.getAttribute("name")]=e.value)}if(e.currentTarget)for(let t=0;t<e.currentTarget.attributes.length;t++){const r=e.currentTarget.attributes[t];r.name.startsWith("data-")&&(a[r.name.replace("data-","")]=r.value)}if(n?.attributes&&"strict"!==e.currentTarget?.getAttribute("source"))for(let e=0;e<n.attributes.length;e++){const t=n.attributes[e];t.name.startsWith("data-")&&(a[t.name.replace("data-","")]=t.value)}if(n.hasAttribute("include")){n.getAttribute("include").split(/[,; ]+/).forEach((t=>{if("all-attributes"===t)for(let t=0;t<n.attributes.length;t++){const r=n.attributes[t];r.name!=="on-"+e.type.toLowerCase()&&(a[r.name]=r.value)}else t.startsWith("~~")?a[t.substring(2)]=sessionStorage.getItem(t.substring(2)):t.startsWith("~")?a[t.substring(1)]=localStorage.getItem(t.substring(1)):a[t]=n.getAttribute(t)||localStorage.getItem(t)||sessionStorage.getItem(t)}))}if(t.includes("?")){t.substring(t.indexOf("?")+1).split("&").forEach((e=>{const t=e.split("=")[0],r=e.split("=")[1];a[t]=r})),t=t.substring(0,t.indexOf("?"))}const l={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)};r?r.setAttribute("loading","true"):n.setAttribute("loading","true");const u=await fetch(t,l),c=u.clone();r?r.removeAttribute("loading"):n.removeAttribute("loading");const d=await u.text();let g;try{g=await c.json()}catch(e){}if(r||g)if(void 0===d||d.startsWith("null"))console.log("No valid response text.");else if(r||console.log("WARNING: No payload target."),d.startsWith("<fatal")&&r.setAttribute("fatal-error","true"),g&&(g instanceof Object||g instanceof Array)){if(Array.isArray(g))g.forEach((e=>{e.startsWith&&(e.startsWith("@")?"@click"===e?r.click():"@focus"===e?r.focus():"@blur"===e?r.blur():"@select"===e?r.select():"@submit"===e?r.submit():"@reset"===e?r.reset():"@remove"===e?r.remove():"@show"===e?r.show?r.show():(r.style.display=r.getAttribute("x-display"),r.removeAttribute("x-display")):"@hide"===e?r.hide?r.hide():(r.setAttribute("x-display",r.style.display),r.style.display="none"):"@scroll-to"===e?r.scrollTo():"@clear"===e?r.value?r.value="":r.innerHTML="":"@reload"===e?window.location.reload():"@back"===e?window.history.back():"@forward"===e?window.history.forward():"@print"===e&&window.print():e.startsWith("-")?(e=e.substring(1),r.classList.remove(e)):e.startsWith("+")?(e=e.substring(1),r.classList.add(e)):r.classList.contains(e)?r.classList.remove(e):r.classList.add(e))}));else if("object"==typeof g)for(let t in g)if("value"===t)r.value=g[t];else if("insertbefore"===t.toLowerCase())r.insertAdjacentHTML("beforebegin",g[t]);else if("insertafter"===t.toLowerCase())r.insertAdjacentHTML("afterend",g[t]);else if("append"===t)r.insertAdjacentHTML("beforeend",g[t]);else if("prepend"===t)r.insertAdjacentHTML("afterbegin",g[t]);else if("innerHTML"===t)r.innerHTML=g[t];else if("outerHTML"===t)r.outerHTML=g[t];else if("innerText"===t)r.innerText=g[t];else if(t.startsWith("?")){const e=t.substring(1),r=new URL(window.location.href);r.searchParams.set(e,g[t]),window.history.pushState({},"",r)}else if(t.startsWith("*"))r.dataset[t.substring(1)]=g[t];else if(t.startsWith("&"))r.style[t.substring(1)]=g[t];else if(t.startsWith("@"))if("@click"===t)"this"===g[t]?e.target.click():"it"===g[t]?e.currentTarget.click():"source"===g[t]?n.click():r.click();else if("@focus"===t)"this"===g[t]?e.target.focus():"it"===g[t]?e.currentTarget.focus():"source"===g[t]?n.focus():r.focus();else if("@blur"===t)"this"===g[t]?e.target.blur():"it"===g[t]?e.currentTarget.blur():"source"===g[t]?n.blur():r.blur();else if("@select"===t)if("this"===g[t])if(e.target.select)e.target.select();else{let t=window.getSelection(),r=document.createRange();r.selectNodeContents(e.target),t.removeAllRanges(),t.addRange(r)}else if("it"===g[t])if(e.currentTarget.select)e.currentTarget.select();else{let t=window.getSelection(),r=document.createRange();r.selectNodeContents(e.currentTarget),t.removeAllRanges(),t.addRange(r)}else if("source"===g[t])if(n.select)n.select();else{let e=window.getSelection(),t=document.createRange();t.selectNodeContents(n),e.removeAllRanges(),e.addRange(t)}else if(r.select)r.select();else{let e=window.getSelection(),t=document.createRange();t.selectNodeContents(r),e.removeAllRanges(),e.addRange(t)}else if("@end"===t)if("this"===g[t])if("INPUT"===e.target.tagName)e.target.selectionStart=e.target.value.length;else{let t=document.createRange(),r=window.getSelection();t.setStart(e.target,1),t.collapse(!0),r.removeAllRanges(),r.addRange(t)}else if("it"===g[t])if("INPUT"===e.currentTarget.tagName)e.currentTarget.selectionStart=e.currentTarget.value.length;else{let t=document.createRange(),r=window.getSelection();t.setStart(e.currentTarget,1),t.collapse(!0),r.removeAllRanges(),r.addRange(t)}else if("source"===g[t])if("INPUT"===n.tagName)n.selectionStart=n.value.length;else{let e=document.createRange(),t=window.getSelection();e.setStart(n,1),e.collapse(!0),t.removeAllRanges(),t.addRange(e)}else if("INPUT"===r.tagName)r.selectionStart=r.value.length;else{let e=document.createRange(),t=window.getSelection();e.setStart(r,1),e.collapse(!0),t.removeAllRanges(),t.addRange(e)}else if("@submit"===t)"this"===g[t]?e.target.submit():"it"===g[t]?e.currentTarget.submit():"source"===g[t]?n.submit():r.submit();else if("@reset"===t)"this"===g[t]?e.target.reset():"it"===g[t]?e.currentTarget.reset():"source"===g[t]?n.reset():r.reset();else if("@show"===t)"this"===g[t]?e.target.show?e.target.show():(e.target.style.display=e.target.getAttribute("x-display"),e.target.removeAttribute("x-display")):"it"===g[t]?e.currentTarget.show?e.currentTarget.show():(e.currentTarget.style.display=e.currentTarget.getAttribute("x-display"),e.currentTarget.removeAttribute("x-display")):"source"===g[t]?n.show?n.show():(n.style.display=n.getAttribute("x-display"),n.removeAttribute("x-display")):r.show?r.show():(r.style.display=r.getAttribute("x-display"),r.removeAttribute("x-display"));else if("@hide"===t)"this"===g[t]?e.target.hide?e.target.hide():(e.target.setAttribute("x-display",e.target.style.display),e.target.style.display="none"):"it"===g[t]?e.currentTarget.hide?e.currentTarget.hide():(e.currentTarget.setAttribute("x-display",e.currentTarget.style.display),e.currentTarget.style.display="none"):"source"===g[t]?n.hide?n.hide():(n.setAttribute("x-display",n.style.display),n.style.display="none"):r.hide?r.hide():(r.setAttribute("x-display",r.style.display),r.style.display="none");else if("@open"===t)"this"===g[t]?"DETAILS"===e.target.tagName?e.target.setAttribute("open","true"):"DIALOG"===e.target.tagName?e.target.show():e.target.open():"it"===g[t]?"DETAILS"===e.currentTarget.tagName?e.currentTarget.setAttribute("open","true"):"DIALOG"===e.currentTarget.tagName?e.currentTarget.show():e.currentTarget.open():"source"===g[t]?"DETAILS"===n.tagName?n.setAttribute("open","true"):"DIALOG"===n.tagName?n.show():n.open():g[t].startsWith("http")?window.open(g[t]):"DETAILS"===r.tagName?r.setAttribute("open","true"):"DIALOG"===r.tagName?r.show():r.open();else if("@close"===t)"this"===g[t]?"DETAILS"===e.target.tagName?e.target.removeAttribute("open"):"DIALOG"===e.target.tagName?e.target.close():e.target.closest("dialog")?.close():"it"===g[t]?"DETAILS"===e.currentTarget.tagName?e.currentTarget.removeAttribute("open"):"DIALOG"===e.currentTarget.tagName?e.currentTarget.close():e.currentTarget.closest("dialog")?.close():"source"===g[t]?"DETAILS"===n.tagName?n.removeAttribute("open"):"DIALOG"===n.tagName?n.close():n.closest("dialog")?.close():"window"===g[t]?window.close():("DETAILS"===r.tagName&&r.removeAttribute("open"),r.close());else if("@scroll-to"===t)r.scrollTo(g[t]);else if("@scroll-by"===t)r.scrollBy(g[t]);else if("@scroll-into-view"===t)r.scrollIntoView(g[t]);else if("@remove"===t)"this"===g[t]?e.target.remove():"it"===g[t]?e.currentTarget.remove():"source"===g[t]?n.remove():r.remove();else if("@clear"===t)"this"===g[t]?e.target.value?e.target.value="":e.target.innerHTML="":"it"===g[t]?e.currentTarget.value?e.currentTarget.value="":e.currentTarget.innerHTML="":"source"===g[t]?n.value?n.value="":n.innerHTML="":r.value?r.value="":r.innerHTML="";else if("@reload"===t)window.location.reload();else if("@redirect"===t)window.location.href=g[t];else if("@back"===t)window.history.back();else if("@forward"===t)window.history.forward();else if("@replace"===t)window.history.replaceState(null,null,g[t]);else if("@download"===t){const e=document.createElement("a");e.href=g[t],e.download="",e.click()}else"@print"===t?window.print():"@alert"===t?alert(g[t]):"@log"===t?console.log(g[t]):"@table"===t?console.table(g[t]):"@nudge"===t&&("this"==g[t]?e.target.dispatchEvent(new CustomEvent("nudge",{bubbles:!0})):"it"==g[t]?e.currentTarget.dispatchEvent(new CustomEvent("nudge",{bubbles:!0})):"source"==g[t]?n.dispatchEvent(new CustomEvent("nudge",{bubbles:!0})):r.dispatchEvent(new CustomEvent("nudge",{bubbles:!0})));else t.startsWith("~~")?sessionStorage.setItem(t.substring(2),g[t]):t.startsWith("~")?localStorage.setItem(t.substring(1),g[t]):t.startsWith("+")?"this"===g[t]?e.target.classList.add(t.substring(1)):"it"===g[t]?(e.currentTarget.classList.add(t.substring(1)),e.currentTarget.classList.add(t.substring(1))):"source"===g[t]?n.classList.add(t.substring(1)):r.classList.add(t.substring(1)):t.startsWith("-")?"this"===g[t]?e.target.classList.remove(t.substring(1)):"it"===g[t]?e.currentTarget.classList.remove(t.substring(1)):"source"===g[t]?n.classList.remove(t.substring(1)):r.classList.remove(t.substring(1)):t.startsWith("#")?document.getElementById(t.substring(1)).innerHTML=g[t]:t.startsWith(">")?n.querySelector(t.substring(1)).innerHTML=g[t]:r&&(null==g[t]?r.removeAttribute(t):r.setAttribute(t,g[t]))}else{if(null==r)return;"outer"===n.getAttribute("target")?r.outerHTML=d:(console.log("+> Standard PAYLOAD-TYPE"),r.value?r.value=d:r.setValue?r.setValue(d):r.innerHTML=d)}else console.log("Fetch complete, but no target or payload.")}async function fileToBase64(e){return new Promise(((t,r)=>{const n=new FileReader;n.onload=()=>t(n.result),n.onerror=e=>r(e),n.readAsDataURL(e)}))}function setupHREF(e){"A"!==e.tagName&&(e.addEventListener("click",(e=>{let t=e.target;e:for(;null!=t;){if(t.hasAttribute("href")){window.location.href=t.getAttribute("href"),t=null;break e}t=t.parentElement}})),e.hasAttribute("tabindex")||e.setAttribute("tabindex","0"),e.addEventListener("keypress",(function(e){"Enter"===e.key&&(window.location.href=e.target.getAttribute("href"))})))}const documentDataHandler={set:function(e,t,r){return e[t]=r,refreshDocumentData(),!0},deleteProperty:function(e,t){return delete e[t],refreshDocumentData(),!0}};var documentData=new Proxy({},documentDataHandler);function setDocumentDataProperty(e,t){if("string"!=typeof e||""===e.trim())return void console.error("setDocumentDataProperty: Path must be a non-empty string.");const r=e.split(".");let n=documentData;for(let e=0;e<r.length-1;e++){const t=r[e];if("object"!=typeof n||null===n)return void console.error(`setDocumentDataProperty: Cannot create/traverse path. Segment '${r.slice(0,e).join(".")}' is not an object:`,n);Object.prototype.hasOwnProperty.call(n,t)&&"object"==typeof n[t]&&null!==n[t]||(n[t]={}),n=n[t]}const a=r[r.length-1];"object"==typeof n&&null!==n?n[a]=t:console.error(`setDocumentDataProperty: Cannot set final property. Parent at path '${r.slice(0,-1).join(".")}' is not an object:`,n)}function scanForComments(e){e.childNodes.forEach((e=>{e.nodeType===Node.COMMENT_NODE&&parseForDocumentData(e),scanForComments(e)}))}function deepMerge(e,t,r){for(let n in t)"object"!=typeof t[n]||null===t[n]||Array.isArray(t[n])?e[n]=t[n]:(e[n]&&"object"==typeof e[n]||(e[n]=new Proxy({},documentDataHandler)),deepMerge(e[n],t[n],r))}function parseForDocumentData(e){if(!e.nodeValue.startsWith("<![CDATA["))return;let t=JSON.parse(e.nodeValue.replace("<![CDATA[","").replace("]]>",""));JSON.parse(JSON.stringify(documentData));if(t.append){const e={...t};delete e.append,deepMerge(documentData,e,documentData)}else for(let e in t)"object"!=typeof t[e]||null===t[e]||Array.isArray(t[e])?documentData[e]=t[e]:(documentData[e]instanceof Object&&"_isProxy"in documentData[e]||(documentData[e]=new Proxy({},documentDataHandler)),deepMerge(documentData[e],t[e],documentData))}function refreshDocumentData(){document.querySelectorAll("[bind]").forEach((e=>{const t=e.getAttribute("bind");let r,n=!1;if(t.includes(".")){let e=t.split("."),a=documentData,o=!0;for(let t=0;t<e.length;t++){if(!a||"object"!=typeof a||!(e[t]in a)){o=!1;break}a=a[e[t]]}o&&(r=a,n=!0)}else t in documentData&&(r=documentData[t],n=!0);if(n)if(e.setValue&&"function"==typeof e.setValue)e.getValue&&"function"==typeof e.getValue?e.getValue()!==r&&(e.setValue(r),e.dispatchEvent(new Event("change",{bubbles:!0}))):(e.setValue(r),e.dispatchEvent(new Event("change",{bubbles:!0})));else{const t=formatForDisplay(r);void 0===e.value||"INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName&&"SELECT"!==e.tagName&&"OPTION"!==e.tagName&&"PROGRESS"!==e.tagName&&"METER"!==e.tagName?void 0!==e.value?(e.value=t,e.dispatchEvent(new Event("change",{bubbles:!0}))):e.innerHTML!==t&&(e.innerHTML=t,e.dispatchEvent(new Event("change",{bubbles:!0}))):e.value!==t&&(e.value=t,e.dispatchEvent(new Event("change",{bubbles:!0})))}}))}function formatForDisplay(e){if(null==e)return"";const t=typeof e;return"string"===t||"number"===t||"boolean"===t?String(e):"function"===t?"":Array.isArray(e)?e.every((e=>["string","number","boolean"].includes(typeof e)))?e.join(", "):"[Array]":"object"===t?"":e instanceof HTMLElement?e.outerHTML||"[Element]":String(e)}HTMLElement.prototype.hudWrite=function(e){if(this.hasAttribute("bind")){const t=this.getAttribute("bind");t?setDocumentDataProperty(t,e):console.warn('Element has "bind" attribute, but it is empty. hudWrite ignored.',this)}},HTMLElement.prototype.hudRead=function(){if(this.hasAttribute("bind")){const e=this.getAttribute("bind");if(e){let t=documentData;const r=e.split(".");for(let e of r){if(!t||"object"!=typeof t||!(e in t))return;t=t[e]}return t}console.warn('Element has "bind" attribute, but it is empty. hudRead ignored.',this)}},window.addEventListener("popstate",(function(e){window.location.reload()}));var focusedForm=null;window.addEventListener("focusin",(e=>{const t=e.target.closest("form");t&&(focusedForm=t)})),window.addEventListener("focusout",(e=>{setTimeout((()=>{if(focusedForm&&!focusedForm.contains(document.activeElement)){const e=new CustomEvent("formblur",{bubbles:!0,cancelable:!0});focusedForm.dispatchEvent(e),focusedForm=null}}),0)}));
